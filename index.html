<!DOCTYPE html>
<html>
<head>
    <meta charset='utf-8' />
    <title>Galapagos Tortoise</title>
    <meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />
    <script src='https://api.tiles.mapbox.com/mapbox-gl-js/v0.53.1/mapbox-gl.js'></script>
    <script src='//d3js.org/d3.v3.min.js' charset='utf-8'></script>
    <link href='https://api.tiles.mapbox.com/mapbox-gl-js/v0.53.1/mapbox-gl.css' rel='stylesheet' />
    <style>
        body { margin:0; padding:0; }
        #map { position:absolute; top:0; bottom:0; width:100%; }
    </style>
</head>
<body>
<style>
body {
  margin: 0;
  padding: 0;
  font-family: 'Georgia', Helvetica, Arial, Sans-serif;
}

#map {
  position: absolute;
  top: 0;
  bottom: 0;
  width: 100%;
}

h1 {
  font-size: 20px;
  line-height: 30px;
}

h2 {
  font-size: 16px;
  line-height: 20px;
  margin-bottom: 10px;
}

a {
  text-decoration: none;
  color: #2dc4b2;
}
p {
  margin: 0;
  padding: 0;
  font-family: 'Georgia', Helvetica, Arial, Sans-serif;
  font-size: 14px;
}
#console {
  position: absolute;
  width: 240px;
  margin: 10px;
  padding: 10px 20px;
  background-color: white;
}
.session {
  margin-bottom: 20px;
}

.row {
  height: 50px;
  width: 100%;
}

.colors {
  background: linear-gradient(to right, #2dc4b2, #3bb3c3, #669ec4, #8b88b6, #a2719b, #aa5e79);
  margin-bottom: 5px;
}

.label {
  width: 15%;
  display: inline-block;
  text-align: center;
}
.btn-control {
font:bold 12px/20px 'Georgia', Arial, Helvetica, sans-serif;
background-color: #3386c0;
color: #fff;


left: 50%;
z-index: 1;
border: none;
width: 200px;
margin: 10px;
display: block;
cursor: pointer;
padding: 10px 20px;
border-radius: 3px;
}

.btn-control:hover {
background-color: #4ea0da;
}

</style>

<div id='map'></div>
<div id='console'>
    <h2>Galapagos Tortoise Movement Ecology Programme 2009-2018</h2>
    <p>(Data: <a href='https://www.datarepository.movebank.org/handle/10255/move.834'>Movebank</a>)</p>

    <h2>Filter by Tortoise Name</h2>
    <div class='row' id='filters'>
    <input id='all' type='radio' name='toggle' value='all' checked='checked'>
    <label for='all'>All</label>
    <input id='Sparkey' type='radio' name='toggle' value='Sparkey'>
    <label for='Sparkey'>Sparkey</label>
    <input id='Charles' type='radio' name='toggle' value='Charles'>
    <label for='Charles'>Charles</label>
    <input id='Chrissie' type='radio' name='toggle' value='Chrissie'>
    <label for='Chrissie'>Chrissie</label>
    <input id='Karlitos' type='radio' name='toggle' value='Karlitos'>
    <label for='Karlitos'>Karlitos</label>
    <input id='Connor' type='radio' name='toggle' value='Connor'>
    <label for='Connor'>Connor</label>
</div>
</div>

<script>
mapboxgl.accessToken = 'pk.eyJ1Ijoic2FtaXJhazkzIiwiYSI6ImNqMnJyeWIzMDAwYjEzM2t6MmY3Mjd4MzEifQ.YzwYknZKK8BmHBVAPPoIKA';

var map = new mapboxgl.Map({
    container: 'map',
    style: 'mapbox://styles/samirak93/cjtp9rrlv0nma1fs5gt17xpd1',
    center: [-90.644592, -0.715843],
    bearing: 20.54,
    zoom: 8.68,
    pitch: 60,
    minZoom: 8.35,
    maxZoom: 15
});

map.on('load', function() {

    map.addSource('tortoise',
    {
    "type": "geojson",
    "data": "geojson.geojson"
    });


    map.addLayer({
        "id": "tortoise-heatmap",
        "type": "heatmap",
        "source": "tortoise",
        "maxzoom": 22,
        "paint": {
            'heatmap-weight': {
                property: 'dbh',
                type: 'exponential',
                 stops: [
                    [0, 0.2],
                    [22, 0.2]
                    ]
        },

            'heatmap-intensity': {
            default: 0.3,
                stops: [
                  [0, 0.3],
                 [22, 0.3]
                 ]
                },

            "heatmap-color": [
                "interpolate",
                ["linear"],
                ["heatmap-density"],
                0, "rgba(0,0,255,0)",
                0.1, "royalblue",
                0.3, "cyan",
                0.5, "lime",
                0.7, "yellow",
                1, "red"
            ],

            'heatmap-radius': {
            default: 10,
             stops: [
                 [0, 10],
                [22, 10]
            ]
            },

            'heatmap-opacity': {
                default: 0.8,
                stops: [
                  [0, 0.8],
                  [22, 0.8]
                    ]
              },
    }
    });

  document.getElementById('filters').addEventListener('change', function(e) {
  var name = e.target.value;
  // update the map filter
  if (name === 'all') {
    filterName = ['!=', ['string', ['get', 'individual-local-identifier']], 'placeholder'];
  } else if (name === 'Sparkey') {
    filterName = ['match', ['get', 'individual-local-identifier'], ['Sparkey'], true, false];
  } else if (name === 'Charles') {
    filterName = ['match', ['get', 'individual-local-identifier'], ['Charles'], true, false];
  } else if (name === 'Chrissie') {
    filterName = ['match', ['get', 'individual-local-identifier'], ['Chrissie'], true, false];
  } else if (name === 'Karlitos') {
    filterName = ['match', ['get', 'individual-local-identifier'], ['Karlitos'], true, false];
  } else if (name === 'Connor') {
    filterName = ['match', ['get', 'individual-local-identifier'], ['Connor'], true, false];
  } else {
    console.log('error');
  }
  map.setFilter('tortoise-heatmap', ['all', filterName,]);

  var filter_data=map.querySourceFeatures('tortoise', {'sourceLayer': 'tortoise', filter: filterName})

  var x=0
  var y=0
  var z=0
  var y_con=0

  for (i = 0; i < filter_data.length; i++) {
  x+=filter_data[i].tile.x
  y+=filter_data[i].tile.y
  z+=filter_data[i].tile.z
  }
  x=x/filter_data.length
  y=y/filter_data.length
  z=z/filter_data.length

  function tile2long(x,z) {
  return (x/Math.pow(2,z)*360-180);
  }

  function tile2lat(y,z) {
  var n=Math.PI-2*Math.PI*y/Math.pow(2,z);
  return (180/Math.PI*Math.atan(0.5*(Math.exp(n)-Math.exp(-n))));
  }

  var NW_long = tile2long(x,z);
  var SW_long = tile2long(x,z);
  var SW_lat =  tile2lat(y+1,z);
  var NE_long = tile2long(x+1,z);
  var NE_lat =  tile2lat(y,z);
  map.fitBounds([[SW_long, SW_lat],[NE_long, NE_lat]],{
  padding: {top: 5, bottom: 5, left: 5, right: 25}});

});
});
</script>


</body>
</html>
